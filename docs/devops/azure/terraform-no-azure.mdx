---
title: 'Microsoft Azure'
description: 'Aprendendo terraform no Azure - Infraestrutura como código e devops'
---

<Info>
  **Pre-requisito** Conhecimento em Cloud, IAAS e Desenvolvimento de Software.
</Info>

<sub>Joel Maykon, 15 de julho 2023</sub>


### Formas de provisionamento da Azure

- Pode ser feito o deploy usando a interface.
- Powershell: linguagem de script do inicialmente windows mas pode ser executado em vários outros sistemas operacionais.
- Azure CLI: Cliente que pode ser instalado na máquina local.
- Azure Cloud Shell: Shell no navegador.
- ARM: Azure Resource Manager - Scrip em Json com os recursos que devem ser criado na nuvem.
- Terraform: Código multi-plataforma que possui providers para deploy de infraestrutura, um desses providers é a Azure.
- Api Rest: Realizando chamadas em determinados endpoins podemos criar recursos na Azure.
- Azure Devops: podemos usar o ciclo de CI para executar scripts e criar nossa infraestrutura.

### Providers Azure
- AzureRM: Permite interagir com a nuvem pública da Azure como contas governamentais.
- Azure Stack: Funciona como o AzureRM mas é para serviços de nuvem Azure dedicados.
- Azure Active Directory: Serve para utilizar as contas do Azure Directory e acessar a rede do AD em máquinas windows.

### Estrutura do AzureRM

```bash azure.terraform
terraform {
  required_providers {
    azurerm = {
      source = "hashicorp/azurerm"
      version = "3.65.0"
    }
  }
}

provider "azurerm" {
  # Config
  version= "=>2.0"
  alias = "aznet"
  subscription_id = var.subid
  client_id = var.clientid
  client_secret = var.secret
}
```

### Azure CLI
- Para instalar o Azure CLI no Ubuntu, você precisar apenas executar esse comando:
<CodeGroup>
```bash Ubuntu
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```
```bash Docker
docker run -it mcr.microsoft.com/azure-cli
```
</CodeGroup>

### Criando um simples grupo de recursos
- É necessário o Azure CLI instalado e executar o comando `az login`
- Executar os comandos: `terraform init`, `terraform validate`, `terraform plan` e `terraform apply`
- Para remover os recursos: `terraform destroy`

```bash main.tf
provider "azurerm" {
  features {
    
  }
}

resource "azurerm_resource_group" "apex_group" {
  name     = "apex"
  location = "West Europe"
}
```

### Azure Blob Storage
- Um blob é um objeto binário grande e uma opção de armazenamento para qualquer tipo de dados que você queira
armazenar em formato binário. 

- Usando o Azure Blob Storage para salvar o estado do terraform backend
```bash main.tf
terraform {
  backend "azurerm" {
    resource_group_name  = "terraformstate"
    storage_account_name = "tfstate_apex"
    container_name       = "terraformstate"
    key                  = "<token storage blob>"
  }
}

provider "azurerm" {
  features {}
}

resource "azurerm_resource_group" "res_group_state" {
  name = "res_group_terraform"
  location = "westus"
}
```